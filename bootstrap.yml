---
# Needs to be performed here, so the secrets are available for the new group
- include: "load-secrets.yml"

- name: bootstrap remote server
  connection: local
  gather_facts: no
  vars:
    # Fortunately, '/root' always exists.  This variable is used to prevent
    # typing errors.
    bootstrap_script: "/root/run-once"

  tasks:
  - name: prepare bootstrap script
    template:
      src: "templates/run-once"
      dest: "{{ bootstrap_script }}"
      mode: "0700"

  - name: execute bootstrap script
    command: "{{ bootstrap_script }}"

  - name: remove bootstrap script
    file:
      path: "{{ bootstrap_script }}"
      state: absent

# vim:ts=2:sw=2:noai:nosi
