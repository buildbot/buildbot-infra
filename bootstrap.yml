# Playbook to bootstrap new service hosts
#
# Prerequisites:
# * basic system is installed (FreeBSD 10.0+) on the target machines
# * there's only root account that allows to connect to those machines
# * root passwords are known for all target machines so we can connect as root
# * ssh access for 'root' is enabled (`PermitRootLogin yes`)
#
# Outcome:
# * machine has basic infrastructure so it can be managed by Ansible:
#   * user "{{ service_account }}" is created
#   * this user is granted passwordless sudo right (added to wheel group)
#   * a crontab entry for running ansible-pull is added
---
- name: perform initial bootstrap of service hosts
  hosts: servicehosts
  gather_facts: no
  # we do not have admin users on the target hosts yet, hence using root
  # directly
  remote_user: root

  tasks:
  # This is the only task that requires 'raw' module
  - name: install ansible
    raw: "env ASSUME_ALWAYS_YES=YES pkg install ansible"

# vim:ft=yaml:nosi:noai:ts=2:sw=2
